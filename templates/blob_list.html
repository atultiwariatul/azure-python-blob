{% extends "base.html" %}

{% block content %}

{% block main %}

<div class="container">
    <div class="row">
        <div class="col">
            <h1>Upload files to Blob <strong>{{ container }}</strong></h1>
            <hr>

            <!-- <form action="/upload" method="POST" enctype="multipart/form-data">

                <div class="form-group">
                    <div>
                        <input type="file" class="custom-file-input" name="file" id="file" multiple>
                        <label class="custom-file-label" for="image">Select Files...</label>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">Upload</button>

            </form> -->

            <p>
            <p id="msg"></p>
            <input type="file" id="multiFiles" name="files[]" multiple="multiple" />
            <button id="upload">Upload</button>
            </p>

        </div>
    </div>
</div>

{% endblock %}


<table id="data" class="table table-dark table-hover">
    <thead>
        <tr>
            <th>Blob Name</th>
            <!-- <th>Age</th>
            <th>Address</th>
            <th>Phone Number</th>
            <th>Email</th> -->
        </tr>
    </thead>
    <tbody>
    </tbody>
</table>
{% endblock %}

{% block scripts %}
<script>
    $(document).ready(function () {
        $('#data').DataTable({
            ajax: '/api/data',
            columns: [
                { data: 'name', searchable: true }
                // { data: 'email' }
            ],
        });
    });
</script>
<script type="text/javascript">
    $(document).ready(function (e) {
        $('#upload').on('click', function () {
            var form_data = new FormData();
            var ins = document.getElementById('multiFiles').files.length;

            if (ins == 0) {
                $('#msg').html('<span style="color:red">Select at least one file</span>');
                return;
            }

            for (var x = 0; x < ins; x++) {
                form_data.append("files[]", document.getElementById('multiFiles').files[x]);
            }

            $.ajax({
                url: 'python-flask-files-upload', // point to server-side URL
                dataType: 'json', // what to expect back from server
                cache: false,
                contentType: false,
                processData: false,
                data: form_data,
                type: 'post',
                success: function (response) { // display success response
                    $('#msg').html('');
                    $.each(response, function (key, data) {
                        if (key !== 'message') {
                            $('#msg').append(key + ' -> ' + data + '<br/>');
                        } else {
                            $('#msg').append(data + '<br/>');
                        }
                    })
                },
                error: function (response) {
                    $('#msg').html(response.message); // display error response
                }
            });
        });
    });
</script>
{% endblock %}